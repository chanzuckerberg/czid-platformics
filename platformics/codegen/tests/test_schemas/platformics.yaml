id: https://czid.org/entities/schema/platformics
title: CZID Platformics Bio-Entities Schema
name: platformics
default_range: string

types:
  string:
    uri: xsd:string
    base: str
    description: A character string

  integer:
    uri: xsd:integer
    base: int
    description: An integer

  uuid:
    uri: xsd:string
    typeof: str
    base: str
    description: A UUID

enums:
  FileStatus:
    permissible_values:
      SUCCESS:
      FAILED:
      PENDING:
  FileAcessProtocol:
    permissible_values:
      s3:
  NucleicAcid:
    permissible_values:
      RNA:
      DNA:
  SequencingProtocol:
    permissible_values:
      ampliseq:
      artic:
      artic_v3:
      artic_v4:
      artic_v5:
      combined_msspe_artic:
      covidseq:
      midnight:
      msspe:
      snap:
      varskip:
      easyseq:
  SequencingTechnology:
    permissible_values:
      Illumina:
      Nanopore:
  TaxonLevel:
    permissible_values:
      level_subspecies:
      level_species:
      level_genus:
      level_family:
      level_order:
      level_class:
      level_phylum:
      level_kingdom:
      level_superkingdom:
  FileAccessProtocol:
    permissible_values:
      s3:
        description: This file is accessible via the (AWS) S3 protocol
  FileUploadClient:
    permissible_values:
      browser:
        description: File uploaded from the user's browser
      cli:
        description: File uploaded from the CLI
      s3:
        description: File uploaded from S3
      basespace:
        description: File uploaded from Illumina Basespace Cloud

classes:
  Entity:
    attributes:
      id:
        identifier: true
        range: uuid
        readonly: true # The API handles generating the values for these fields
        required: true
      producing_run_id:
        range: uuid
        minimum_value: 0
        annotations:
          mutable: false  # This field can't be modified by an `Update` mutation
          system_writable_only: True
      owner_user_id:
        range: integer
        minimum_value: 0
        readonly: true
        required: true
      collection_id:
        range: integer
        minimum_value: 0
        required: true
        annotations:
          mutable: false
      created_at:
        range: date
        required: true
        readonly: true
      updated_at:
        range: date
        readonly: true
      deleted_at:
        range: date
        readonly: true
    # NOTE - the LinkML schema doesn't support a native "plural name" field as far as I can tell, so
    # we're using an annotation here to tack on the extra functionality that we need. We do this because
    # English pluralization is hard, and we don't want to have to write a custom pluralization function.
    # This basically means we now have our own "dialect" of LinkML to worry about. We may want to see if
    # pluralization can be added to the core spec in the future.
    annotations:
      plural: Entities
 
  File:
    attributes:
      id:
        identifier: true
        range: uuid
      entity_field_name:
        range: string
        required: true
      entity:
        range: Entity
        required: true
      status:
        range: FileStatus
        required: true
      protocol:
        range: FileAccessProtocol
        required: true
      namespace:
        range: string
        required: true
      path:
        range: string
        required: true
      file_format:
        range: string
        required: true
      compression_type:
       range: string
      size:
        range: integer
        minimum_value: 0

  Sample:
    is_a: Entity
    mixins:
      - EntityMixin
    attributes:
      name:
        range: string
        required: true
      sample_type:
        range: string
        required: true
      water_control:
        range: boolean
        required: true
      collection_date:
        range: date
      collection_location:
        range: string
        required: true
      notes:
        range: string
      sequencing_reads:
        range: SequencingRead
        multivalued: true
        inverse: SequencingRead.sample
      system_mutable_field:
        range: string
        annotations:
          system_writable_only: True
    annotations:
      plural: Samples

  SequencingRead:
    is_a: Entity
    mixins:
      - EntityMixin
    attributes:
      sample:
        range: Sample
        inverse: Sample.sequencing_reads
      protocol:
        range: SequencingProtocol
        required: true
        annotations:
          mutable: false
      r1_file:
        range: File
        readonly: true
      r2_file:
        range: File
        readonly: true
      technology:
        range: SequencingTechnology
        required: true
      nucleic_acid:
        range: NucleicAcid
        required: true
      primer_file:
        range: GenomicRange
        inverse: GenomicRange.sequencing_reads
        annotations:
          mutable: false
      clearlabs_export:
        range: boolean
        required: true
      taxon:
        range: Taxon
        inverse: Taxon.sequencing_reads
        annotations:
          mutable: false
    annotations:
      plural: SequencingReads

  GenomicRange:
    is_a: Entity
    mixins:
      - EntityMixin
    attributes:
      file:
        range: File
        readonly: true
      sequencing_reads:
        range: SequencingRead
        inverse: SequencingRead.primer_file
        multivalued: true
    annotations:
      plural: GenomicRanges

  Taxon:
    is_a: Entity
    mixins:
      - EntityMixin
    attributes:
      name:
        range: string
        required: true
      is_phage:
        range: boolean
        required: true
      upstream_database:
        range: UpstreamDatabase
        required: true
        inverse: UpstreamDatabase.taxa
      upstream_database_identifier:
        range: string
        required: true
      level:
        range: TaxonLevel
        required: true
      sequencing_reads:
        range: SequencingRead
        inverse: SequencingRead.taxon
        multivalued: true
    annotations:
      plural: Taxa

  SystemWritableOnlyType:
    is_a: Entity
    mixins:
      - EntityMixin
    attributes:
      name:
        range: string
        required: true
    annotations:
      system_writable_only: true
      plural: SystemWritableOnlyTypes

  ImmutableType:
    is_a: Entity
    mixins:
      - EntityMixin
    attributes:
      name:
        range: string
        required: true
    annotations:
      mutable: false
      plural: ImmutableTypes

  UpstreamDatabase:
    is_a: Entity
    mixins:
      - EntityMixin
    attributes:
      name:
        range: string
        required: true
      taxa:
        range: Taxon
        multivalued: true
        inverse: Taxon.upstream_database
    annotations:
      plural: UpstreamDatabases

  EntityMixin:
    mixin: true
    attributes:
      entity_id:
        required: true
        readonly: true
        range: uuid
        identifier: true
        inverse: entity.id
        annotations:
          hidden: true

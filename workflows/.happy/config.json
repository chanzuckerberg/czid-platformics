{
    "default_env": "dev",
    "app": "workflows",
    "default_compose_env_file": ".env.ecr",
    "environments": {
        "dev": {
            "aws_profile": "idseq-dev",
            "aws_region": "us-west-2",
            "k8s": {
                "namespace": "czid-dev-happy-happy-env",
                "cluster_id": "czid-dev-eks",
                "auth_method": "eks"
            },
            "terraform_directory": ".happy/terraform/envs/dev",
            "task_launch_type": "k8s",
            "stack_overrides": {
                "additional_env_vars": {
                    "AWS_REGION": "us-west-2",
                    "BOTO_ENDPOINT_URL": "http://motoserver.czidnet:4000",
                    "CERBOS_URL": "http://localhost:3592",
                    "DEFAULT_UPLOAD_BUCKET": "local-bucket",
                    "DEFAULT_UPLOAD_PROTOCOL": "s3",
                    "ENTITY_SERVICE_AUTH_TOKEN": "eyJhbGciOiJFQ0RILUVTIiwiZW5jIjoiQTI1NkNCQy1IUzUxMiIsImVwayI6eyJjcnYiOiJQLTM4NCIsImt0eSI6IkVDIiwieCI6IkNFSUZ5SmhHX09FRFpOYV9GN0NveFFMTWRnSy1vaW5wRVMxZmFQNHk5cC13ZU51c1JKVm9yMXJZbU5JdXh6ekgiLCJ5IjoicnRPM1FRYS1xRFR2VTNIa3IyUVQ5eE1kanpydzd0Y0xyVl9oSE4zVDdjRUVoQy00czg4ZE5mNU42SkxyM3YyeSJ9LCJraWQiOiItQmx2bF9wVk5LU2JRQ2N5dGV4UzNfMk5MaHBia2J6LVk5VFFjbkY5S1drIiwidHlwIjoiSldFIn0..9K7pNxXmTBf5fzX_H_Uqbw.87heaMhVrIb-ZO6jrbWtcR3c8kt8Otokten2nA6iX8LTOzDx2vqXaMd_8qoJd5UsbV409RTi67_hZ-cZKhL3wXxD_DkURU_y_qXl_alnyZBAdCMEy0LB_Uts4y88RFSh0Ke_RrFYg0MhH0AsMTPoBNQjCbbYaF-uFyW23pdOBzK2qFRpRy1BCLYBxBaVBU5wy05h58BY3Hzn1bDVMOXHbMgHniT3vKD-iM6ZsNiGbmC9GT59VSDLn0emzPBx3_xlk2cYk3ZwptGNXwaSH9Ez6z0gQTNtfDmE0aZzVypD7ZF_0tf5JBs30B5wk4xJdwmyXy_qazFJoOfIyT5rPvVuDbfXatD1fQ1UXDrB-_FU7asC58JNxkemgJ7onWrKs3CZk38HWkO0b7wBhSuGy8KnkLqQWv5y9NlIOaLQv2EpaeIRI22WTfxpwOhcDrw6RnB6DEdsogvpacLbWxohaOudfQl73rk-PfgN_VpPOXlFVHViMTGr83lLgXfCC_E-Q4GpOe_McCK1BQ-Qn0SBF32ofkAk6w5e348cHFUNc9VJ5QPqqzoZvYQJVcFD_FpPaETR.lWx9pYq25tJEory9WJMQTCtoEMwodVYNQA9O5qqQV6A",
                    "ENTITY_SERVICE_URL": "http://ryan-test-entities:8008",
                    "JWK_PRIVATE_KEY_FILE": "/var/policies/private_key.pem",
                    "JWK_PUBLIC_KEY_FILE": "/var/policies/public_key.pem",
                    "PLATFORMICS_EVENT_BUS_PLUGIN": "swipe",
                    "PLATFORMICS_EVENT_BUS__REDIS__QUEUE_NAME": "workflow-events",
                    "PLATFORMICS_EVENT_BUS__REDIS__REDIS_URL": "redis://redis.czidnet:6378",
                    "PLATFORMICS_EVENT_BUS__SWIPE__SQS_QUEUE_URL": "https://sqs.us-west-2.amazonaws.com/732052188396/idseq-swipe-staging-web-sfn-notifications-queue",
                    "PLATFORMICS_WORKFLOW_RUNNER_PLUGIN": "swipe",
                    "PLATFORMICS_WORKFLOW_RUNNER__LOCAL__S3_ENDPOINT": "",
                    "PLATFORMICS_WORKFLOW_RUNNER__SWIPE__OUTPUT_S3_PREFIX": "s3://idseq-samples-development/nextgen/",
                    "PLATFORMICS_WORKFLOW_RUNNER__SWIPE__STATE_MACHINE_ARN": "arn:aws:states:us-west-2:732052188396:stateMachine:idseq-swipe-sandbox-default-wdl",
                    "WORKERS": "2"
                },
                "emptydir_volumes": [
                    {
                        "name": "policies",
                        "parameters": {
                            "size_limit": "100Mi"
                        }
                    }
                ],
                "services": {
                    "workflows": {
                        "cpu": "2",
                        "health_check_path": "/graphql",
                        "init_containers": {
                            "init": {
                                "cmd": [
                                    "cp",
                                    "-r",
                                    "/workflows/cerbos/",
                                    "/var/policies/"
                                ],
                                "image": "{workflows}",
                                "tag": "${var.image_tag}"
                            }
                        },
                        "memory": "1000Mi",
                        "service_type": "INTERNAL",
                        "sidecars": {
                            "cerbos": {
                                "args": [
                                    "server",
                                    "--config",
                                    "/var/policies/cerbos/config/config.yaml"
                                ],
                                "cpu": "100m",
                                "image": "ghcr.io/cerbos/cerbos",
                                "memory": "300Mi",
                                "port": 3592,
                                "tag": "0.29.0"
                            }
                        }
                    }
                },
                "source": "git@github.com:chanzuckerberg/happy//terraform/modules/happy-stack-eks?ref=rlim/ephemeral-volume-support",
                "tasks": {
                    "migrate": {
                        "cmd": [
                            "/workflows/scripts/migrate.sh"
                        ],
                        "cpu": "100m",
                        "image": "{workflows}:${var.image_tag}",
                        "memory": "1000Mi",
                        "platform_architecture": "arm64"
                    }
                }
            }
        },
        "sandbox": {
            "aws_profile": "idseq-dev",
            "aws_region": "us-west-2",
            "k8s": {
                "namespace": "czid-sandbox-happy-happy-env",
                "cluster_id": "czid-sandbox-eks",
                "auth_method": "eks"
            },
            "terraform_directory": ".happy/terraform/envs/sandbox",
            "task_launch_type": "k8s",
            "stack_overrides": {
                "additional_env_vars": {
                    "AWS_REGION": "us-west-2",
                    "BOTO_ENDPOINT_URL": "http://motoserver.czidnet:4000",
                    "CERBOS_URL": "http://localhost:3592",
                    "DEFAULT_UPLOAD_BUCKET": "local-bucket",
                    "DEFAULT_UPLOAD_PROTOCOL": "s3",
                    "ENTITY_SERVICE_AUTH_TOKEN": "eyJhbGciOiJFQ0RILUVTIiwiZW5jIjoiQTI1NkNCQy1IUzUxMiIsImVwayI6eyJjcnYiOiJQLTM4NCIsImt0eSI6IkVDIiwieCI6InU2cDh2eTZCLVZMLUxqRmptUzg2N0N2cWtkLV9pcFJGM2pJR2tHakh6eWU3b3Q2SkQzUWQ5YTM0Nk5feU40d2oiLCJ5IjoiRkdWb1VPOUJhQXRScU1sR3g1NWlCblU2MEQxeHJSZXVJRDFOa25zQnYyRTJLNnVLTUMwU2xsSTdPYVFHZXd6NSJ9LCJraWQiOiItQmx2bF9wVk5LU2JRQ2N5dGV4UzNfMk5MaHBia2J6LVk5VFFjbkY5S1drIiwidHlwIjoiSldFIn0..i3Rq4DgR5HCWzzIegXt0qg.EmsK8VO2h9MG4wIFc8UNDs2eeMna7G9l-vaALVzZe5WKs4zRQz0k9K4PD96oMUxdHDvmOXnWMIfK8RYxcu_fIy4DFCdhHbsu7FBODK5fA3yJXYVBzIpcDFEKhxhaNrPaxos2neOD8cB5XFEl958t4aAR5zPXR_DUsTErfdo7SLsT3jAYm6hGqL8qZrdzGhoMaqk4tHfKM_ItXg-V5yfRvyK4CQLu_TquMMeh4mfWUH4wFHMTgSS5b8m2TcHQYt_HahSld6RyY07Fm9wrBPb83MI1tdyQJo1jik-h-8tG2-4uzasoOxosXz-PalGarvYmC8PtfyUdoDKaA5waF--OYD3z7ahPrBup9DCL_h8H3oQq9qd6B3DBq077LTfJ2o2Fq9_MZc0u-JAKuRrxmjtyCUjpUHG-YsBe-GNGdDVzVx5xvYGRE4ZSRSNkmnim7fFRmV0C711iZOl1w60Ke8iDcOr6N5eMEyIs65CLLD7koWrCkPFIYvf_V88miwtvNrsba9ISBu_fhmOy7Bsop5uw-k6Atg2QSlkcjWEqONEHYf115tENOYxciGr_z69OD9W8.dg4WmTnBm3RLaoJ8Ga1OxthzcKW03EoXeTGfIMyrK34",
                    "ENTITY_SERVICE_URL": "http://entities-entities:8008",
                    "JWK_PRIVATE_KEY_FILE": "/var/policies/private_key.pem",
                    "JWK_PUBLIC_KEY_FILE": "/var/policies/public_key.pem",
                    "PLATFORMICS_EVENT_BUS_PLUGIN": "swipe",
                    "PLATFORMICS_EVENT_BUS__REDIS__QUEUE_NAME": "workflow-events",
                    "PLATFORMICS_EVENT_BUS__REDIS__REDIS_URL": "redis://redis.czidnet:6378",
                    "PLATFORMICS_EVENT_BUS__SWIPE__SQS_QUEUE_URL": "https://sqs.us-west-2.amazonaws.com/732052188396/idseq-swipe-dev-web-sfn-notifications-queue",
                    "PLATFORMICS_WORKFLOW_RUNNER_PLUGIN": "swipe",
                    "PLATFORMICS_WORKFLOW_RUNNER__LOCAL__S3_ENDPOINT": "",
                    "PLATFORMICS_WORKFLOW_RUNNER__SWIPE__OUTPUT_S3_PREFIX": "s3://idseq-samples-development/nextgen/",
                    "PLATFORMICS_WORKFLOW_RUNNER__SWIPE__STATE_MACHINE_ARN": "arn:aws:states:us-west-2:732052188396:stateMachine:idseq-swipe-sandbox-default-wdl",
                    "SERVICE_NAME": "workflows",
                    "WORKERS": "2"
                },
                "emptydir_volumes": [
                    {
                        "name": "policies",
                        "parameters": {
                            "size_limit": "100Mi"
                        }
                    }
                ],
                "services": {
                    "workflows": {
                        "cpu": "2",
                        "health_check_path": "/graphql",
                        "init_containers": {
                            "init": {
                                "cmd": [
                                    "cp",
                                    "-r",
                                    "/workflows/cerbos/",
                                    "/var/policies/"
                                ],
                                "image": "{workflows}",
                                "tag": "${var.image_tag}"
                            }
                        },
                        "memory": "1000Mi",
                        "service_type": "INTERNAL",
                        "sidecars": {
                            "cerbos": {
                                "args": [
                                    "server",
                                    "--config",
                                    "/var/policies/cerbos/config/config.yaml"
                                ],
                                "cpu": "100m",
                                "image": "ghcr.io/cerbos/cerbos",
                                "memory": "300Mi",
                                "port": 3592,
                                "tag": "0.29.0"
                            }
                        }
                    }
                },
                "source": "git@github.com:chanzuckerberg/happy//terraform/modules/happy-stack-eks?ref=rlim/ephemeral-volume-support",
                "tasks": {
                    "migrate": {
                        "cmd": [
                            "/workflows/scripts/migrate.sh"
                        ],
                        "cpu": "100m",
                        "image": "{workflows}:${var.image_tag}",
                        "memory": "1000Mi",
                        "platform_architecture": "arm64"
                    }
                }
            }
        },
        "staging": {
            "aws_profile": "idseq-dev",
            "aws_region": "us-west-2",
            "k8s": {
                "namespace": "czid-staging-happy-happy-env",
                "cluster_id": "czid-staging-eks",
                "auth_method": "eks"
            },
            "terraform_directory": ".happy/terraform/envs/staging",
            "task_launch_type": "k8s",
            "stack_overrides": {
                "services": {
                    "workflows": {
                        "health_check_path": "/graphql/",
                        "path": "/graphql/*",
                        "priority": 0,
                        "service_type": "PRIVATE",
                        "success_codes": "200-499"
                    }
                },
                "source": "git@github.com:chanzuckerberg/happy//terraform/modules/happy-stack-eks?ref=main"
            }
        }
    },
    "tasks": {
        "migrate": [
            "migrate"
        ]
    },
    "services": [
        "workflows"
    ],
    "features": {
        "enable_dynamo_locking": true,
        "enable_happy_api_usage": true,
        "enable_ecr_auto_creation": true,
        "enable_unified_config": true
    },
    "api": {},
    "stack_defaults": {
        "create_dashboard": false,
        "routing_method": "CONTEXT",
        "services": {
            "workflows": {
                "name": "workflows",
                "platform_architecture": "arm64",
                "port": 8042
            }
        }
    }
}